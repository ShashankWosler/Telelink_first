# This workflow will build a Java project with Maven, and cache/restore any dependencies to improve the workflow execution time

# For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-maven

name: Java CI with Maven

on:

  push:

    branches: [ main ]

  pull_request:

    branches: [ main ]



jobs:

  build:



    runs-on: ubuntu-latest



    steps:

    - uses: actions/checkout@v2

    - name: Set up JDK 11

      uses: actions/setup-java@v2

      with:

        java-version: '17'

        distribution: 'adopt'

        cache: maven

    - name: Build with Maven

      run: mvn -B package --file pom.xml

      
    - name: Send Email with Attachment
        env:
          SENDGRID_API_KEY: ${{ secrets.SENDGRID_API_KEY }}
        run: |
          curl --request POST \
            --url https://api.sendgrid.com/v3/mail/send \
            --header "Authorization: Bearer $SENDGRID_API_KEY" \
            --header 'Content-Type: application/json' \
            --data '{
              "personalizations": [
                {
                  "to": [
                    {
                      "email": "shreyas@wosler.ca" 
                    }
                  ],
                  "subject": "Telelink HTML Report"
                }
              ],
              "from": {
                "email": "shashank.tiwari@wosler.ca"
              },
              "content": [
                {
                  "type": "text/html",
                  "value": "<html><body><h1>Hello, Shreyas!</h1><p>This is your HTML report.</p></body></html>"
                }
              ],
              "attachments": [
                {
                  "content": "'$(base64 report.html)'",
                  "filename": "report.html",
                  "type": "text/html",
                  "disposition": "attachment"
                }
              ]
            }
